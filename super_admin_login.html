<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Super Admin - Connexion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="vendor/phosphor/index.js"></script>
  <script src="vendor/supabase/supabase.js"></script>
  <style>
    :root {
      --ink: #0c2f35;
      --navy: #0f304b;
      --red: #ce3c35;
      --sand: #b58a64;
      --bg: #f7f5f2;
    }
    body { font-family: 'Outfit', sans-serif; background: radial-gradient(120% 100% at 15% 10%, #e4eef1 0%, #fdfaf7 45%, #f7f5f2 100%); color: var(--ink); min-height: 100vh; }
    .card { background: #ffffffcc; backdrop-filter: blur(16px); border: 1px solid rgba(12,47,53,0.08); box-shadow: 0 20px 70px rgba(15,48,75,0.12); }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background: rgba(12,47,53,0.08); color: var(--navy); font-weight:600; font-size:12px; letter-spacing:0.04em; }
    .btn-main { background: linear-gradient(120deg, var(--navy), var(--ink)); color: #fff; transition: transform .15s ease, box-shadow .15s ease; }
    .btn-main:hover { transform: translateY(-1px); box-shadow: 0 12px 32px rgba(12,47,53,0.28); }
    .btn-ghost { border:1px solid #d9e0e7; background:#fff; color: var(--navy); }
    .field { border:1px solid #d9e0e7; background:#fff; }
    .field:focus { outline:none; border-color: var(--navy); box-shadow: 0 0 0 3px rgba(15,48,75,0.18); }
    .bg-shape { position:absolute; inset:0; overflow:hidden; pointer-events:none; }
    .bg-shape::before { content:""; position:absolute; width:420px; height:420px; background: radial-gradient(circle, rgba(15,48,75,0.18), transparent 60%); top:-120px; left:-80px; filter: blur(12px); }
    .bg-shape::after { content:""; position:absolute; width:380px; height:380px; background: radial-gradient(circle, rgba(206,60,53,0.14), transparent 60%); bottom:-120px; right:-40px; filter: blur(14px); }
  </style>
</head>
<body class="relative">
  <div class="bg-shape"></div>
  <div class="max-w-6xl mx-auto px-6 py-12 lg:py-16 relative z-10">
    <div class="grid md:grid-cols-2 gap-10 items-center">
      <div class="space-y-6">
        <span class="pill"><i class="ph-bold ph-crown"></i> Super Admin</span>
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Connexion Super Admin</h1>
        <p class="text-slate-600 leading-relaxed">Accedez au panneau central pour gerer les societes, salaries, contrats et acces utilisateurs. L'identifiant de demarrage est fourni ci-dessous.</p>
        <div class="grid sm:grid-cols-2 gap-3">
          <div class="card rounded-2xl p-4">
            <p class="text-xs font-semibold text-slate-500 uppercase">Identifiant initial</p>
            <p class="text-base font-semibold text-slate-900">nessalyspro@gmail.com</p>
            <p class="text-sm text-slate-600">Mot de passe: Admin123456!</p>
          </div>
          <div class="card rounded-2xl p-4">
            <p class="text-xs font-semibold text-slate-500 uppercase">Profil</p>
            <p class="text-base font-semibold text-slate-900">Superviseur global</p>
            <p class="text-sm text-slate-600">Acces a l'ensemble des modules.</p>
          </div>
        </div>
      </div>

      <div class="card rounded-3xl p-8 lg:p-10 space-y-6">
        <div class="space-y-1">
          <p class="text-sm text-slate-500">Bienvenue</p>
          <h2 class="text-2xl font-semibold text-slate-900">Connectez-vous</h2>
        </div>
        <form id="login-form" class="space-y-4">
          <div>
            <label class="text-sm font-semibold text-slate-700">Email</label>
            <div class="relative mt-2">
              <i class="ph ph-envelope text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
              <input id="email" type="email" autocomplete="username" required class="field w-full rounded-xl px-10 py-3 text-sm" placeholder="Email">
            </div>
          </div>
          <div>
            <label class="text-sm font-semibold text-slate-700">Mot de passe</label>
            <div class="relative mt-2">
              <i class="ph ph-lock text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
              <input id="password" type="password" autocomplete="current-password" required class="field w-full rounded-xl px-10 py-3 text-sm" placeholder="Mot de passe">
              <button type="button" id="toggle-password" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 text-lg" aria-label="Afficher le mot de passe"><i class="ph ph-eye"></i></button>
            </div>
          </div>
          <div class="flex flex-col sm:flex-row gap-3">
            <button type="submit" id="login-btn" class="btn-main w-full rounded-xl py-3 font-semibold flex items-center justify-center gap-2"><i class="ph-bold ph-sign-in"></i> Connexion</button>
            <button type="button" id="prefill-btn" class="btn-ghost w-full rounded-xl py-3 font-semibold flex items-center justify-center gap-2"><i class="ph-bold ph-magic-wand"></i> Remplir super admin</button>
          </div>
          <p id="message" class="text-sm text-center"></p>
        </form>
        <div class="text-center text-sm text-slate-500">Retour au portail <a href="index.html" class="text-slate-900 font-semibold">Accueil</a></div>
      </div>
    </div>
  </div>

  <script>
    const supabaseUrl = 'https://fmfylsykljkvyurcprij.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZtZnlsc3lrbGprdnl1cmNwcmlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1ODQ3OTgsImV4cCI6MjA3OTE2MDc5OH0.hfgBflnh-nr1Ljfl5Chkp0y1EbZbm5XiyyDhsQcdSqE';
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('login-btn');
    const prefillBtn = document.getElementById('prefill-btn');
    const msg = document.getElementById('message');
    const togglePwdBtn = document.getElementById('toggle-password');

    const defaultEmail = 'nessalyspro@gmail.com';
    const defaultPassword = 'Admin123456!';

    function setMessage(text, type='info') {
      msg.textContent = text;
      msg.className = 'text-sm text-center ' + (type === 'error' ? 'text-red-600' : 'text-emerald-600');
    }

    async function ensureSuperAdminUser() {
      // Tries to create the super admin. If it exists, ignore the error.
      const { error } = await supabaseClient.auth.signUp({ email: defaultEmail, password: defaultPassword });
      if (error && error.code !== 'user_already_exists' && !/already/i.test(error.message || '')) {
        console.warn('Creation super admin impossible:', error.message);
      }
    }

    async function handleLogin(event) {
      event.preventDefault();
      loginBtn.disabled = true;
      loginBtn.textContent = 'Connexion...';
      setMessage('');
      try {
        await ensureSuperAdminUser();
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        if (!email || !password) { setMessage('Renseignez email et mot de passe.', 'error'); return; }
        const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
        if (error) { setMessage('Connexion impossible: ' + (error.message || 'verifiez vos identifiants'), 'error'); return; }
        if (data?.session) {
          localStorage.setItem('supabaseSession', JSON.stringify(data.session));
        }
        setMessage('Connexion reussie. Redirection...');
        window.location.href = 'dashboard_admin.html';
      } catch (e) {
        console.error(e);
        setMessage('Erreur inattendue. Reessayez.', 'error');
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'Connexion';
      }
    }

    document.getElementById('login-form').addEventListener('submit', handleLogin);
    prefillBtn.addEventListener('click', () => { emailInput.value = defaultEmail; passwordInput.value = defaultPassword; setMessage('Identifiants super admin remplis.'); });
    togglePwdBtn.addEventListener('click', () => {
      const isPassword = passwordInput.type === 'password';
      passwordInput.type = isPassword ? 'text' : 'password';
      togglePwdBtn.innerHTML = isPassword ? '<i class="ph ph-eye-slash"></i>' : '<i class="ph ph-eye"></i>';
    });

    // Seed the super admin on load (non bloquant)
    ensureSuperAdminUser();
  </script>
</body>
</html>

